(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function() {
    'use strict';

    require('./setup.js')
    require('./network-sites.js')
    require('./user-profile.js')
})()

},{"./network-sites.js":2,"./setup.js":4,"./user-profile.js":5}],2:[function(require,module,exports){
jQuery(function($) {
    'use strict';

    var setEnabled = function (elem, enabled) {
        var inner = elem.find('.js-2fa-inner')
        inner.html('<input type="checkbox">')
        inner.find('input').prop('checked', enabled)

        inner.find('input').click(function (event) {
            event.preventDefault()

            $.ajax({
                method: 'POST',
                url: ajaxurl,
                data: {
                    action: '2fa_network_site_toggle',
                    nonce: elem.find('.nonce').val(),
                    blog_id: elem.find('.blog_id').val(),
                    enabled: !enabled ? 'yes' : 'no',
                },
            })
                        .done(function (data) {
                            if (data.success) {
                                setEnabled(elem, !enabled)
                            } else {
                                alert('error5. TODO')
                            }
                        })
                        .fail(function () {
                                alert('error6. TODO')
                        })
        })
    }

    $('.js-2fa-toggle').each(function () {
        var $this = $(this)
        var inner = $this.find('.js-2fa-inner')

        setEnabled($this, $this.find('.enabled').val() === '1')
    })
})

},{}],3:[function(require,module,exports){
/* global angular */
/**
 * https://gist.github.com/kirkstrobeck/599664399dbc23968741
 *
 * the HTML5 autofocus property can be finicky when it comes to dynamically
 * loaded templates and such with AngularJS. Use this simple directive to tame
 * this beast once and for all.
 *
 * Usage:
 * <input type="text" autofocus>
 */
(function () {
  'use strict';

  angular.module('utils.autofocus', [])

  .directive('autofocus', ['$timeout',
    function ($timeout) {
      return {
        restrict: 'A',
        link: function ($scope, $element) {
          $timeout(function () {
            $element[0].focus();
          });
        }
      };
    }
  ]);
})();

},{}],4:[function(require,module,exports){
(function() {
    'use strict';

    require('./ng-autofocus.js')

    var urlencoded = function(obj) {
        var str = [];
        for(var p in obj)
            str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        return str.join("&");
    }

    var setup = angular.module('2fa', ['utils.autofocus'])

    setup.controller('Setup', function ($rootScope, $http) {

        $rootScope.$watch('step', function(newValue, oldValue) {
            if (newValue === 'totp-2') {
                $http({
                    method: 'POST',
                    url: window.ajaxurl,
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    transformRequest: urlencoded,
                    data: {
                        action: '2fa_generate_secret',
                        nonce: document.getElementById('2fa_generate_secret').value,
                    },
                })
                            .success(function (data) {
                                if (data.error) {
                                    alert('unexpected error2. TODO')
                                } else {
                                    $rootScope.totp_secret = data.secret
                                }
                            })
                            .error(function (data) {
                                alert('unexpected error1. TODO')
                            })
            } else if (newValue === 'sms-2') {
                $http({
                    method: 'POST',
                    url: window.ajaxurl,
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    transformRequest: urlencoded,
                    data: {
                        action: '2fa_sms_send_verification',
                        nonce: document.getElementById('2fa_sms_send_verification').value,
                        number: $rootScope.sms_number,
                    },
                })
                            .success(function (data) {
                                if (data.error) {
                                    $rootScope.sms_sent = 'error'
                                } else {
                                    $rootScope.sms_sent = 'sent'
                                }
                            })
                            .error(function (data) {
                                $rootScope.sms_sent = 'error'
                            })
            }
        })

        $rootScope.verify = function (token, deviceName) {
            $rootScope.verification = 'verifying'

            $http({
                method: 'POST',
                url: window.ajaxurl,
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                transformRequest: urlencoded,
                data: {
                    action: '2fa_verify',
                    nonce: document.getElementById('2fa_verify').value,
                    token: token,
                    deviceName: deviceName,
                },
            })
                        .success(function (data) {
                            if (data.valid) {
                                $rootScope.verification = 'valid'
                            } else if (data.error) {
                                alert('unexpected error4. TODO')
                            } else {
                                $rootScope.verification = 'invalid'
                            }
                        })
                        .error(function (data) {
                            alert('unexpected error3. TODO')
                            $rootScope.verification = 'invalid'
                        })
        }

        $rootScope.sms_verify = function (token, deviceName) {
            $rootScope.verification = 'verifying'

            $http({
                method: 'POST',
                url: window.ajaxurl,
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                transformRequest: urlencoded,
                data: {
                    action: '2fa_sms_verify',
                    nonce: document.getElementById('2fa_sms_verify').value,
                    token: token,
                    deviceName: deviceName,
                },
            })
                        .success(function (data) {
                            if (data.error) {
                                alert('unexpected error5. TODO')
                                $rootScope.verification = 'invalid'
                            } else if (data.valid) {
                                $rootScope.verification = 'valid'
                            } else {
                                $rootScope.verification = 'invalid'
                            }
                        })
                        .error(function (data) {
                            alert('unexpected error6. TODO')
                            $rootScope.verification = 'invalid'
                        })
        }

        $rootScope.rand = function () {
            return Math.floor(Math.random()*16777215).toString(16)
        }

        $rootScope.prettyPrintSecret = function (secret) {
            if (typeof secret === 'string') {
                return secret.replace(/(....)/g, '$1 ').trim()
            }
        }

    })
})()

},{"./ng-autofocus.js":3}],5:[function(require,module,exports){
jQuery(function($) {
    'use strict';

    $('.js-2fa-deactivate').click(function () {
        var $this = $(this)
          , user = $this.attr('data-user')
          , nonce = $this.attr('data-nonce')

        if (confirm('Are you sure?')) {
            $.ajax({
                method: 'POST',
                url: ajaxurl,
                data: {
                    action: '2fa_deactivate',
                    user: user,
                    nonce: nonce,
                },
            })
                        .done(function (data) {
                            if (data.success) {
                                $this.parents('.column-2fa').find('.2fa-status').text(data.new_status)
                            } else {
                                alert('Error. Please try again.')
                            }
                        })
                        .fail(function () {
                            alert('Error. Please try again.')
                        })
        }
    })
})

},{}]},{},[1]);
